/**
 * å¯¼èˆªé¢æ¿ç»„ä»¶
 * 
 * åŠŸèƒ½æè¿°ï¼š
 * 1. æ˜¾ç¤ºå¯¼èˆªç›®çš„åœ°ä¿¡æ¯
 * 2. å±•ç¤ºè·¯çº¿è§„åˆ’ï¼ˆæ¨¡æ‹Ÿæ–‡å­—ï¼‰
 * 3. å“åº”å¯¼èˆªæŒ‡ä»¤æ›´æ–°
 * 
 * @author è½¦è½½å¤šè®¾å¤‡ååŒåŠ©æ‰‹é¡¹ç›®ç»„
 */

import { hilog } from '@kit.PerformanceAnalysisKit';

/**
 * å¯¼èˆªä¿¡æ¯æ¥å£
 */
interface NavigationInfo {
  destination: string;      // ç›®çš„åœ°
  distance: string;         // è·ç¦»
  estimatedTime: string;    // é¢„è®¡æ—¶é—´
  routeInfo: string;        // è·¯çº¿ä¿¡æ¯
  isNavigating: boolean;    // æ˜¯å¦æ­£åœ¨å¯¼èˆª
}

@Component
export struct NavigationPanel {
  @State navInfo: NavigationInfo = {
    destination: 'æœªè®¾ç½®ç›®çš„åœ°',
    distance: '-- km',
    estimatedTime: '-- åˆ†é’Ÿ',
    routeInfo: 'è¯·å…ˆè®¾ç½®å¯¼èˆªç›®çš„åœ°',
    isNavigating: false
  };
  
  private readonly TAG: string = 'NavigationPanel';
  
  build() {
    Column() {
      // é¢æ¿æ ‡é¢˜
      Row() {
        Text('ğŸ§­ å¯¼èˆªç³»ç»Ÿ')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor('#FFFFFF')
        
        Blank()
        
        // å¯¼èˆªçŠ¶æ€æŒ‡ç¤ºå™¨
        If (this.navInfo.isNavigating) {
          Row() {
            Circle()
              .width(12)
              .height(12)
              .fill('#4CAF50')
              .margin({ right: 8 })
            
            Text('å¯¼èˆªä¸­')
              .fontSize(14)
              .fontColor('#4CAF50')
          }
        }
      }
      .width('100%')
      .padding({ bottom: 16 })
      
      // ç›®çš„åœ°ä¿¡æ¯
      Column() {
        Text('ç›®çš„åœ°')
          .fontSize(14)
          .fontColor('#AAAAAA')
          .selfAlign(ItemAlign.Start)
          .margin({ bottom: 8 })
        
        Text(this.navInfo.destination)
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor('#FFFFFF')
          .maxLines(1)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
      }
      .width('100%')
      .padding({ bottom: 20 })
      
      // è·¯çº¿ä¿¡æ¯
      Column() {
        // è·ç¦»å’Œæ—¶é—´
        Row() {
          Column() {
            Text(this.navInfo.distance)
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor('#4CAF50')
            
            Text('å‰©ä½™è·ç¦»')
              .fontSize(12)
              .fontColor('#AAAAAA')
          }
          .layoutWeight(1)
          .alignItems(HorizontalAlign.Center)
          
          Column() {
            Text(this.navInfo.estimatedTime)
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor('#2196F3')
            
            Text('é¢„è®¡æ—¶é—´')
              .fontSize(12)
              .fontColor('#AAAAAA')
          }
          .layoutWeight(1)
          .alignItems(HorizontalAlign.Center)
        }
        .width('100%')
        .padding({ bottom: 20 })
        
        // è·¯çº¿è¯¦æƒ…
        Column() {
          Text('è·¯çº¿è§„åˆ’')
            .fontSize(14)
            .fontColor('#AAAAAA')
            .selfAlign(ItemAlign.Start)
            .margin({ bottom: 8 })
          
          Text(this.navInfo.routeInfo)
            .fontSize(14)
            .fontColor('#FFFFFF')
            .textAlign(TextAlign.Start)
            .lineHeight(20)
        }
        .width('100%')
      }
      
      // æ“ä½œæŒ‰é’®
      Row() {
        Button('å¼€å§‹å¯¼èˆª')
          .backgroundColor(this.navInfo.isNavigating ? '#9E9E9E' : '#4CAF50')
          .fontColor('#FFFFFF')
          .layoutWeight(1)
          .margin({ right: 8 })
          .onClick(() => {
            this.startNavigation();
          })
        
        Button('ç»“æŸå¯¼èˆª')
          .backgroundColor('#F44336')
          .fontColor('#FFFFFF')
          .layoutWeight(1)
          .margin({ left: 8 })
          .onClick(() => {
            this.stopNavigation();
          })
      }
      .width('100%')
      .padding({ top: 20 })
    }
    .width('100%')
    .backgroundColor('#1E1E1E')
    .borderRadius(16)
    .padding(20)
  }
  
  /**
   * æ›´æ–°å¯¼èˆªä¿¡æ¯
   */
  updateNavigation(destination: string, routeInfo?: string): void {
    this.navInfo = {
      destination: destination,
      distance: this.calculateDistance(destination),
      estimatedTime: this.calculateTime(destination),
      routeInfo: routeInfo || this.generateRouteInfo(destination),
      isNavigating: this.navInfo.isNavigating
    };
    
    hilog.info(0x0000, this.TAG, 'Navigation info updated: %{public}s', destination);
  }
  
  /**
   * å¼€å§‹å¯¼èˆª
   */
  private startNavigation(): void {
    if (this.navInfo.destination !== 'æœªè®¾ç½®ç›®çš„åœ°') {
      this.navInfo = {
        ...this.navInfo,
        isNavigating: true
      };
      hilog.info(0x0000, this.TAG, 'Navigation started to: %{public}s', this.navInfo.destination);
    }
  }
  
  /**
   * ç»“æŸå¯¼èˆª
   */
  private stopNavigation(): void {
    this.navInfo = {
      ...this.navInfo,
      isNavigating: false
    };
    hilog.info(0x0000, this.TAG, 'Navigation stopped');
  }
  
  /**
   * è®¡ç®—è·ç¦»ï¼ˆæ¨¡æ‹Ÿï¼‰
   */
  private calculateDistance(destination: string): string {
    // æ¨¡æ‹Ÿè·ç¦»è®¡ç®—
    const distances = {
      'å…¬å¸': '12.5 km',
      'å®¶': '8.2 km',
      'å•†åœº': '3.7 km',
      'åŠ æ²¹ç«™': '2.1 km',
      'åŒ»é™¢': '5.8 km'
    };
    
    return distances[destination as keyof typeof distances] || '10.0 km';
  }
  
  /**
   * è®¡ç®—æ—¶é—´ï¼ˆæ¨¡æ‹Ÿï¼‰
   */
  private calculateTime(destination: string): string {
    // æ¨¡æ‹Ÿæ—¶é—´è®¡ç®—
    const times = {
      'å…¬å¸': '25åˆ†é’Ÿ',
      'å®¶': '18åˆ†é’Ÿ',
      'å•†åœº': '12åˆ†é’Ÿ',
      'åŠ æ²¹ç«™': '8åˆ†é’Ÿ',
      'åŒ»é™¢': '15åˆ†é’Ÿ'
    };
    
    return times[destination as keyof typeof times] || '20åˆ†é’Ÿ';
  }
  
  /**
   * ç”Ÿæˆè·¯çº¿ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿï¼‰
   */
  private generateRouteInfo(destination: string): string {
    const routeTemplates = [
      '1. æ²¿å½“å‰é“è·¯ç›´è¡Œ2å…¬é‡Œ\n2. å³è½¬è¿›å…¥ä¸»å¹²é“\n3. ç»§ç»­è¡Œé©¶8å…¬é‡Œ\n4. å·¦è½¬åˆ°è¾¾ç›®çš„åœ°',
      '1. ä»å½“å‰ä½ç½®å‡ºå‘\n2. ç»è¿‡3ä¸ªçº¢ç»¿ç¯\n3. è¡Œé©¶çº¦10åˆ†é’Ÿ\n4. åˆ°è¾¾æŒ‡å®šåœ°ç‚¹',
      '1. èµ°æœ€è¿‘è·¯çº¿\n2. é¢„è®¡è€—æ—¶è¾ƒçŸ­\n3. è·¯å†µè‰¯å¥½\n4. å®‰å…¨æŠµè¾¾'
    ];
    
    return routeTemplates[Math.floor(Math.random() * routeTemplates.length)];
  }
}