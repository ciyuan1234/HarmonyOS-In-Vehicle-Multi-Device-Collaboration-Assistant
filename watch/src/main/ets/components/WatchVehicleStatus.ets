import { VehicleStatus } from '../../../../shared/src/main/ets/model/DeviceModel';
import { formatSpeed, formatFuelLevel, formatTemperature } from '../../../../shared/src/main/ets/utils/CommonUtils';

/**
 * æ‰‹è¡¨è½¦è¾†çŠ¶æ€æ¦‚è§ˆç»„ä»¶
 */
@Component
export struct WatchVehicleStatus {
  @State vehicleStatus: VehicleStatus = {
    speed: 0,
    engineStatus: false,
    fuelLevel: 80,
    temperature: 22,
    doorLocked: true,
    latitude: 39.9042,
    longitude: 116.4074,
    updateTime: Date.now()
  };

  build() {
    Column() {
      // æ ‡é¢˜
      Text('è½¦è¾†çŠ¶æ€')
        .fontSize(12)
        .fontWeight(FontWeight.Medium)
        .fontColor('#FFFFFF')
        .margin({ bottom: 8 })
      
      // çŠ¶æ€æŒ‡æ ‡
      Grid() {
        GridItem() {
          this.renderStatusItem('ğŸš€', 'è½¦é€Ÿ', formatSpeed(this.vehicleStatus.speed))
        }
        
        GridItem() {
          this.renderStatusItem(
            this.vehicleStatus.engineStatus ? 'ğŸŸ¢' : 'ğŸ”´',
            'å‘åŠ¨æœº',
            this.vehicleStatus.engineStatus ? 'è¿è¡Œ' : 'åœæ­¢'
          )
        }
        
        GridItem() {
          this.renderStatusItem('â›½', 'ç‡ƒæ²¹', formatFuelLevel(this.vehicleStatus.fuelLevel))
        }
        
        GridItem() {
          this.renderStatusItem('ğŸŒ¡ï¸', 'æ¸©åº¦', formatTemperature(this.vehicleStatus.temperature))
        }
      }
      .columnsTemplate('1fr 1fr')
      .rowsTemplate('1fr 1fr')
      .columnsGap(8)
      .rowsGap(8)
    }
    .width('100%')
    .backgroundColor('#000000')
    .borderRadius(12)
    .padding(12)
  }

  /**
   * æ¸²æŸ“çŠ¶æ€é¡¹
   */
  @Builder
  renderStatusItem(icon: string, label: string, value: string) {
    Column() {
      Text(icon)
        .fontSize(16)
        .margin({ bottom: 2 })
      
      Text(value)
        .fontSize(10)
        .fontWeight(FontWeight.Bold)
        .fontColor('#FFFFFF')
        .margin({ bottom: 2 })
      
      Text(label)
        .fontSize(8)
        .fontColor('#AAAAAA')
    }
    .alignItems(HorizontalAlign.Center)
  }

  /**
   * æ›´æ–°è½¦è¾†çŠ¶æ€
   */
  updateStatus(status: VehicleStatus): void {
    this.vehicleStatus = { ...status };
  }
}